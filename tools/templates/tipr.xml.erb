<?xml version="1.0" encoding="UTF-8"?>
<mets xmlns="http://www.loc.gov/METS/" xmlns:xlink="http://www.w3.org/1999/xlink"
      OBJID="<%= @dip.ieid %>"
      LABEL="<%= @dip.package_id %>">

  <metsHdr CREATEDATE="<%= @dip.create_date.xmlschema %>">
    <agent ROLE="DISSEMINATOR" TYPE="ORGANIZATION">
      <name>FCLA</name>
      <note>tipr-1.0.0</note>
    </agent>
  </metsHdr>
  
  <amdSec>
    <rightsMD ID="rights-metadata-0">
      <mdRef LOCTYPE="URL" MDTYPE="PREMIS" xlink:href="tipr-rights.xml"/>
    </rightsMD>
  </amdSec>

  <fileSec>
    <fileGrp>
<%# At most we can have two representations. %>
      <file ID="file-0" CHECKSUM="<%= @orig[:sha_1] %>" CHECKSUMTYPE="SHA-1">
	<FLocat LOCTYPE="URL" xlink:href="tipr-rep-1.xml"/>
      </file>
<% if @dip.migration_map %>
      <file ID="file-1" CHECKSUM="<%= @active[:sha_1] %>" CHECKSUMTYPE="SHA-1">
	<FLocat LOCTYPE="URL" xlink:href="tipr-rep-2.xml"/>
      </file>
<% end %>
    </fileGrp>
  </fileSec>

  <structMap>
    <div>
<%# Original should be active if we haven't migrated. %>
      <div <% if not @dip.migration_map %> TYPE="ACTIVE" <% end %> ORDER="1">
	<fptr FILEID="file-0"/>
      </div>
<% if @dip.migration_map %>
      <div TYPE="ACTIVE" ORDER="2">
	<fptr FILEID="file-1"/>
      </div>
<% end %>
    </div>
  </structMap>
  
</mets>
